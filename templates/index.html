<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>HBA1C Prediction</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        .model-info {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-success {
            background-color: #28a745;
        }
        .status-warning {
            background-color: #ffc107;
        }
        .status-error {
            background-color: #dc3545;
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="mt-5">HBA1C Prediction</h1>
    <p>Select Patient ID, Visited Date, and Sugar value to predict HBA1C.</p>

    <!-- Model Loading Status -->
    <div class="model-info">
        <h5><strong>Model Status:</strong></h5>
        {% if model_loaded %}
            <span class="status-indicator status-success"></span>
            <span class="text-success"><strong>✓ Model Loaded Successfully</strong></span>
            <br>
            <small class="text-muted">
                Source: Dagshub MLflow<br>
                Run ID: {{ current_run_id or 'Loading...' }}<br>
                Type: RandomForestRegressor (100 estimators)<br>
                Trained on 14,000+ patient records
            </small>
        {% else %}
            <span class="status-indicator status-warning"></span>
            <span class="text-warning"><strong>⚠ Loading Model...</strong></span>
            <br>
            <small class="text-muted">
                Downloading from Dagshub...<br>
                Please wait, this may take 30-60 seconds on first load
            </small>
        {% endif %}
    </div>

    {% if error %}
    <div class="alert alert-danger" role="alert">
        <strong>Error:</strong> {{ error }}
    </div>
    {% endif %}

    <div class="alert alert-info" role="alert">
        Choose sugar levels between 50 and 600. HBA1C levels are influenced by sugar values: higher sugar typically results in higher HBA1C. This machine learning project uses synthetic data and is not a definitive method to determine HBA1C levels. For accurate results, please select a date within 2024. The dataset contains dates from 2023 to April 2024. Patient names are fictional. Users can only select from existing patient IDs, and there is no correlation between User ID and sugar levels.
    </div>

    <form method="post">
        <div class="form-group">
            <label for="patient_id">Patient ID</label>
            <select class="form-control" id="patient_id" name="patient_id" required>
                {% for patient_id in patient_ids %}
                <option value="{{ patient_id }}">{{ patient_id }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="visited_date">Visited Date</label>
            <input type="date" class="form-control" id="visited_date" name="visited_date" required>
        </div>
        <div class="form-group">
            <label for="sugar">Sugar</label>
            <input type="number" class="form-control" id="sugar" name="sugar" required min="50" max="600" step="0.1">
        </div>
        <button type="submit" class="btn btn-primary" {% if not model_loaded %}disabled{% endif %}>Predict HBA1C</button>
    </form>

    {% if prediction is not none %}
    <div class="alert alert-success mt-4" role="alert">
        <h4>Prediction Result</h4>
        Predicted HBA1C: <strong>{{ "%.2f"|format(prediction) }}%</strong>
    </div>
    {% elif prediction is sameas none and model_loaded and request.method == 'POST' %}
    <div class="alert alert-danger mt-4" role="alert">
        <strong>Error:</strong> Could not make prediction. Please check your input values.
    </div>
    {% endif %}
    <p>Model pipelines built using Metaflow. Experiments tracked in MLflow. Model stored in DagsHub. Dockerized and deployed with CI/CD via GitHub Actions.</p>
</div>
</body>
</html>
